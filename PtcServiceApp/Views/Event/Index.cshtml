@{
    ViewBag.Title = "Event";
}

<div class="row">
    <div class="content-wrapper-before gradient-45deg-indigo-purple"></div>
    <div class="breadcrumbs-dark pb-0 pt-4" id="breadcrumbs-wrapper">
        <!-- Search for small screen-->
        <div class="container">
            <div class="row">
                <div class="col s10 m6 l6">
                    <h5 class="breadcrumbs-title mt-0 mb-0"><span>Manage Events</span></h5>
                    <ol class="breadcrumbs mb-0">
                        <li class="breadcrumb-item"><a asp-controller="Dashboard" asp-action="AdminDashboard">Home</a>
                        </li>
                        <li class="breadcrumb-item active">Manage Events</li>
                    </ol>
                </div>
                <div class="col s2 m6 l6">
                    <a class="waves-effect waves-light breadcrumbs-btn right btn modal-trigger add-status-btn" href="#modal1"><i class="material-icons left">add</i> Add New</a>
                </div>
            </div>
        </div>
    </div>
    <div class="col s12">
        <div class="container">
            <div class="section section-data-tables">
                <!-- Page Length Options -->
                <div class="row">
                    <div class="col s12">
                        <div class="card">
                            <div class="progress datable-loading hide">
                                <div class="indeterminate"></div>
                            </div>
                            <div class="card-content">
                                <h4 class="card-title">Events Data</h4>
                                <div class="row">
                                    <div class="col s12">
                                        <table id="tblDepartment" class="display">
                                            <thead>
                                            <tr>
                                                <th style="width: 20px">#</th>
                                                <th>Image</th>
                                                <th>Description</th>
                                                <th>Status</th>
                                                <th>Created Date</th>
                                                <th>Updated Date</th>
                                                <th>Action</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                                
                                            </tbody>
                                            <tfoot>
                                            <tr>
                                                <th style="width: 20px">#</th>
                                                <th>Image</th>
                                                <th>Description</th>
                                                <th>Status</th>
                                                <th>Created Date</th>
                                                <th>Updated Date</th>
                                                <th>Action</th>
                                            </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        @* <div class="content-overlay show"></div> *@
    </div>
</div>

<!-- Modal Structure -->
<div id="modal1" class="modal">
    <div class="progress ae-loading hide mt-0">
        <div class="indeterminate"></div>
    </div>
    <div class="modal-content">

        <h5>Add New Event</h5>

        <form action="" enctype="multipart/form-data">
            <div class="row">
                <div class="input-field col s12">
                    <p>Maximum file upload size 1MB.</p>
                    <input type="file" id="image" class="dropify" data-max-file-size="1M" />
                </div>
                <div class="input-field col s12">
                    <input type="text" class="validate" id="subject" required>
                    <label for="subject">Subject *</label>
                </div>
                <div class="input-field col s12">
                    <textarea id="description" class="materialize-textarea validate" required></textarea>
                    <label for="description">Description *</label>
                </div>
                <div class="input-field col s12">
                    <div class="switch">
                        Active Status
                        <label class="float-right">
                            <input class="active" type="checkbox" id="active" checked="checked" value="1">
                            <span class="lever ml-0">
                            </span>
                        </label>
                    </div>
                </div>
            </div>
        </form>
        
    </div>
    <div class="modal-footer">
        <div class="row">
            <div class="col s12">
                <button class="btn waves-effect waves-light modal-close btn-light-red" type="submit" name="action">Cancel
                    <i class="material-icons left">close</i>
                </button>
                <button class="btn waves-effect waves-light" type="submit" id="save_btn" name="action">Save
                    <i class="material-icons right">send</i>
                </button>
            </div>
        </div>
    </div>
</div>

<script src="~/assets/vendors/jquery/jquery-3.6.3.min.js"></script>
<script type="text/javascript">
    let eventSubNav = document.querySelectorAll('.event-sub-nav');
    
    document.querySelector('.administrator-main-nav').classList.add('active');
    eventSubNav.forEach((item) => {
        item.classList.add('active');
    });
    
    $(document).ready(function() {
        
        //Add data into database
        $('#save_btn').click(function() {
            addEvent();
        });
    });
    
    let isActive = 1;
    $("input[type='checkbox'].active").click(function () {
        if ($("input[type='checkbox'].active").is(':checked')) {
            isActive = 1;
        } else {
            isActive = 0;
        }
    });
    
    let photo;
    function imageReader(input)
    {
        if(input.files && input.files[0])
        {
            var reader = new FileReader();
            reader.onload = function(e)
            {
                photo = e.target.result;
                //console.log(img);
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
    
    $('#image').change(function() {
        imageReader(this);
    });
        
    function addEvent() {
        let images;
        images = photo.split(',');
        
        let subject = $('#subject').val();
        let description = $('#description').val();
        
        $.ajax({
            url: '@Url.Action("AddEvent", "Event")',
            type: 'POST',
            dataType: 'JSON',
            data: {photo: images[1], subject: subject, description: description, active: isActive},
            beforeSend: function() {
                console.log("Loading...");
            },
            success: function(data) {
                if (data === 1) {
                    M.toast({html:"Successfully added!"});
                } else {
                    alert("Your data not add please try again later!");
                }
            },
            error: function (err) {
                console.log(err);
            },
            complete: function() {
               console.log("Success");
            }
        });
    }
    
</script>
